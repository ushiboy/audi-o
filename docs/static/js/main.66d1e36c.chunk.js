(this["webpackJsonpaudi-o"]=this["webpackJsonpaudi-o"]||[]).push([[0],{104:function(e,t,n){},105:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(12),i=n.n(c),o=n(9),u=n.n(o),s=n(13),d=n(41),l=n(45),j=function(){function e(){Object(d.a)(this,e),this.chunks=void 0,this.mediaRecorder=void 0,this.analyser=void 0,this.chunks=[],this.mediaRecorder=null,this.analyser=null}return Object(l.a)(e,[{key:"start",value:function(){var e=this;return this.chunks=[],navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){var n=new AudioContext,r=n.createMediaStreamSource(t);e.analyser=n.createAnalyser(),e.analyser.fftSize=2048,r.connect(e.analyser),e.mediaRecorder=new MediaRecorder(t),e.mediaRecorder.ondataavailable=function(t){e.chunks.push(t.data)},e.mediaRecorder.start()}))}},{key:"stop",value:function(){var e=Object(s.a)(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(null==t.mediaRecorder)throw new Error("Recorder does not started");t.mediaRecorder.onstop=function(){try{var r=new Blob(t.chunks,{type:"audio/ogg; codecs=opus"});e(r)}catch(a){n(a)}},t.mediaRecorder.stop()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getData",value:function(){if(null==this.analyser)throw new Error("Recorder does not started");var e=this.analyser.frequencyBinCount,t=new Uint8Array(e);return this.analyser.getByteTimeDomainData(t),t}},{key:"getBufferSize",value:function(){if(null==this.analyser)throw new Error("Recorder does not started");return this.analyser.frequencyBinCount}}]),e}(),f=n(76),h=n(75),b=function(e){Object(f.a)(n,e);var t=Object(h.a)(n);function n(){var e;return Object(d.a)(this,n),(e=t.call(this,"AudiODatabase")).audioRecords=void 0,e.version(1).stores({audioRecords:"++id, title, data, createdAt, modifiedAt"}),e.audioRecords=e.table("audioRecords"),e}return n}(n(63).a),O=function(){function e(){Object(d.a)(this,e),this.db=new b}return Object(l.a)(e,[{key:"fetchAudioRecords",value:function(){var e=Object(s.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.audioRecords.orderBy("modifiedAt").toArray();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){var t=e.id,n=e.title,r=e.createdAt,a=e.modifiedAt;if(void 0===t)throw new Error("id is undefined");return{id:t,title:n,createdAt:r,modifiedAt:a}})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchAudioRecord",value:function(){var e=Object(s.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.audioRecords.get(t);case 2:if(void 0!==(n=e.sent)){e.next=5;break}throw new Error("Audio Record Not Found. [".concat(t,"]"));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createAudioRecord",value:function(){var e=Object(s.a)(u.a.mark((function e(t,n){var r,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Date,a=r,e.next=4,this.db.audioRecords.add({title:t,data:n,createdAt:r,modifiedAt:a});case 4:return c=e.sent,e.abrupt("return",{id:c,title:t,createdAt:r,modifiedAt:a});case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteAudioRecord",value:function(){var e=Object(s.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.audioRecords.delete(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteAllAudioRecord",value:function(){var e=Object(s.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.audioRecords.clear();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),x=n(22),p=n(146),v=n(147),y=n(58),m=n(149),w=n(157),k=n(145),R=n(150),A=n(153),C=n(148),g=n(156),D=n(74),S=n.n(D),E=n(155),F=n(136),T=n(137),B=n(138),P=n(152),I=n(140),L=n(141),U=n(37),M=n.n(U),N=n(68),q=n.n(N),z=n(4),W=function(e){var t=e.onCreatedFile,n=e.onCancelCreate,a=Object(r.useState)(""),c=Object(x.a)(a,2),i=c[0],o=c[1];return Object(z.jsxs)(E.a,{open:!0,children:[Object(z.jsx)(F.a,{children:"Create Audio"}),Object(z.jsxs)(T.a,{children:[Object(z.jsx)(B.a,{children:"Enter the title of the audio data."}),Object(z.jsx)(P.a,{autoFocus:!0,label:"Title",type:"text",fullWidth:!0,value:i,onChange:function(e){o(e.target.value)}})]}),Object(z.jsxs)(I.a,{children:[Object(z.jsx)(L.a,{onClick:n,color:"primary",startIcon:Object(z.jsx)(M.a,{}),children:"DROP"}),Object(z.jsx)(L.a,{disabled:0===i.length,startIcon:Object(z.jsx)(q.a,{}),onClick:function(){t(i)},color:"primary",children:"SAVE"})]})]})},G=function(e){var t=e.record,n=e.onDeleteFile,r=e.onCancelDelete;return Object(z.jsxs)(E.a,{open:!0,children:[Object(z.jsx)(F.a,{children:"Delete Audio"}),Object(z.jsx)(T.a,{children:Object(z.jsx)(B.a,{children:"Do you want to delete the file?"})}),Object(z.jsxs)(I.a,{children:[Object(z.jsx)(L.a,{onClick:r,color:"primary",children:"CANCEL"}),Object(z.jsx)(L.a,{startIcon:Object(z.jsx)(M.a,{}),onClick:function(){n(t)},color:"primary",children:"DELETE"})]})]})},H=n(142),J=n(143),V=n(144),_=n(71),K=n.n(_),Q=n(70),X=n.n(Q),Y=n(151),Z=a.a.createContext(new j),$=a.a.createContext(new O),ee=function(){return Object(r.useContext)($)},te=function(e){var t=e.record,n=e.onPlayClick,r=e.onDeleteClick,a=t.id,c=t.title,i=t.modifiedAt,o=ee();return Object(z.jsxs)(H.a,{children:[Object(z.jsx)(J.a,{children:Object(z.jsx)(y.a,{children:c})}),Object(z.jsxs)(V.a,{children:[Object(z.jsx)(w.a,{title:"play",children:Object(z.jsx)(k.a,{"aria-label":"play",onClick:function(){n(t)},children:Object(z.jsx)(X.a,{})})}),Object(z.jsx)(w.a,{title:"download",children:Object(z.jsx)(k.a,{"aria-label":"download",onClick:Object(s.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.fetchAudioRecord(a);case 2:t=e.sent,(n=document.createElement("a")).download="".concat(c,".ogg"),r=URL.createObjectURL(t.data),n.href=r,n.click();case 8:case"end":return e.stop()}}),e)}))),children:Object(z.jsx)(K.a,{})})}),Object(z.jsx)(w.a,{title:"delete",children:Object(z.jsx)(k.a,{"aria-label":"delete",onClick:function(){r(t)},children:Object(z.jsx)(M.a,{})})}),Object(z.jsx)(y.a,{children:Object(Y.a)(i,"yyyy/MM/dd HH:mm:ss")})]})]})},ne=n(72),re=n.n(ne),ae=n(73),ce=n.n(ae),ie=function(e){var t=e.onRecordedAudio,n=Object(r.useContext)(Z),a=Object(r.useRef)(null),c=Object(r.useRef)(0),i=Object(r.useState)(!1),o=Object(x.a)(i,2),d=o[0],l=o[1],j=function e(){c.current=requestAnimationFrame(e),ue(a.current,n)};return Object(r.useEffect)((function(){return oe(a.current),function(){cancelAnimationFrame(c.current)}}),[]),Object(z.jsxs)(A.a,{children:[Object(z.jsx)("canvas",{ref:a,style:{height:120,width:"100%"}}),Object(z.jsx)(L.a,{style:{marginRight:5},variant:"contained",color:"secondary",disabled:d,startIcon:Object(z.jsx)(re.a,{}),onClick:Object(s.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.next=3,n.start();case 3:j();case 4:case"end":return e.stop()}}),e)}))),children:"Record"}),Object(z.jsx)(L.a,{variant:"contained",color:"primary",disabled:!d,startIcon:Object(z.jsx)(ce.a,{}),onClick:Object(s.a)(u.a.mark((function e(){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.stop();case 2:r=e.sent,l(!1),cancelAnimationFrame(c.current),oe(a.current),void 0!==r&&t(r);case 7:case"end":return e.stop()}}),e)}))),children:"Stop"})]})},oe=function(e){if(null!=e){var t=e.width,n=e.height,r=e.getContext("2d");null!=r&&(r.fillStyle="#e0f7fa",r.fillRect(0,0,t,n),r.lineWidth=1,r.strokeStyle="#4caf50",r.beginPath(),r.moveTo(0,n/2),r.lineTo(t,n/2),r.stroke())}},ue=function(e,t){if(null!=e){var n=e.width,r=e.height,a=e.getContext("2d");if(null!=a){a.fillStyle="#e0f7fa",a.fillRect(0,0,n,r),a.lineWidth=1,a.strokeStyle="#4caf50",a.beginPath();for(var c=t.getBufferSize(),i=1*n/c,o=t.getData(),u=0,s=0;s<c;s++){var d=o[s]/128*r/2;0===s?a.moveTo(u,d):a.lineTo(u,d),u+=i}a.lineTo(n,r/2),a.stroke()}}},se=function(e){var t=e.audioRecord,n=Object(r.useRef)(null),a=t.id,c=t.title,i=ee();return Object(r.useEffect)((function(){var e=n.current;if(null!==e)return Object(s.a)(u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.fetchAudioRecord(a);case 2:n=t.sent,e.src=URL.createObjectURL(n.data),e.play();case 5:case"end":return t.stop()}}),t)})))(),function(){e.pause()}}),[t,i]),Object(z.jsx)(p.a,{position:"fixed",style:{top:"auto",bottom:0},children:Object(z.jsxs)(v.a,{children:[Object(z.jsx)(y.a,{style:{marginRight:20},children:c}),Object(z.jsx)("audio",{ref:n,controls:!0})]})})},de=Object(C.a)((function(){return Object(g.a)({root:{flexGrow:1},title:{flexGrow:1}})})),le=function(){var e=de(),t=Object(r.useState)([]),n=Object(x.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(null),o=Object(x.a)(i,2),d=o[0],l=o[1],j=Object(r.useState)(null),f=Object(x.a)(j,2),h=f[0],b=f[1],O=Object(r.useState)(null),C=Object(x.a)(O,2),g=C[0],D=C[1],E=ee();return Object(r.useEffect)((function(){Object(s.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.fetchAudioRecords();case 2:t=e.sent,c(t);case 4:case"end":return e.stop()}}),e)})))()}),[E]),Object(z.jsxs)("div",{className:e.root,children:[Object(z.jsx)(p.a,{position:"fixed",children:Object(z.jsxs)(v.a,{children:[Object(z.jsx)(y.a,{variant:"h6",className:e.title,children:"Audi-O"}),Object(z.jsx)(m.a,{href:"https://github.com/ushiboy/audi-o",color:"inherit",target:"_blank",rel:"noopener",children:Object(z.jsx)(w.a,{title:"github",children:Object(z.jsx)(k.a,{edge:"end",color:"inherit",children:Object(z.jsx)(S.a,{})})})})]})}),Object(z.jsxs)(R.a,{fixed:!0,style:{marginTop:70},children:[Object(z.jsx)(ie,{onRecordedAudio:function(e){l({title:"",data:e})}}),a.map((function(e){return Object(z.jsx)(A.a,{pt:2,children:Object(z.jsx)(te,{record:e,onPlayClick:function(e){b(e)},onDeleteClick:function(e){D(e)}})},e.id)}))]}),null!==d?Object(z.jsx)(W,{onCreatedFile:function(){var e=Object(s.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.createAudioRecord(t,d.data);case 2:n=e.sent,c((function(e){return e.concat([n])})),l(null);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onCancelCreate:function(){l(null)}}):null,null!==g?Object(z.jsx)(G,{record:g,onDeleteFile:function(){var e=Object(s.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.deleteAudioRecord(t.id);case 2:c((function(e){return e.filter((function(e){return e.id!==t.id}))})),null!==h&&h.id===t.id&&b(null),D(null);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onCancelDelete:function(){D(null)}}):null,null!==h?Object(z.jsx)(se,{audioRecord:h}):null]})};n(104);i.a.render(Object(z.jsx)($.Provider,{value:new O,children:Object(z.jsx)(Z.Provider,{value:new j,children:Object(z.jsx)(le,{})})}),document.getElementById("root"))}},[[105,1,2]]]);